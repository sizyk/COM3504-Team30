<% var editModalName = plant._id + "-edit-plant-modal"%>

<div class="grid grid-cols-1 gap-4 2xl:grid-cols-2">
  <!--  Image Div  -->
  <div class="m-auto">
    <img
      src="<%= plant.image %>"
      alt=""
      class="max-h-[65vh] overflow-hidden border-8 border-text"
      data-plant-image
    />
  </div>
  <!--  Content Div  -->
  <div class="flex h-[100%] flex-col overflow-hidden">
    <div class="border-b-4 border-text">
      <h2 class="text-3xl font-bold" data-name><%= plant.name %></h2>
      <p class="italic" data-scientific>Flower Scientific Name</p>
      <p>Discovered by <b><%= plant.author%></b></p>
      <div class="mb-1 flex flex-row justify-between">
        <p>
          <span data-spotted><%= plant.spottedString %></span>
          <span data-emoji><%= plant.emoji %></span>
        </p>
      </div>
    </div>

    <p class="flex-fill-remaining-space" data-description>
      <%= plant.description %>
    </p>
    <div class="mt-auto">
      <div
        class="m-2 flex flex-row justify-evenly gap-2 rounded-lg bg-background p-2 dark:bg-background-inverse"
      >
        <div class="has-tooltip touchscreen-hover" data-leaves>
          <img
            src="/public/img/icons/has-leaf-<%= plant.hasLeaves %>.svg"
            alt="An icon showing that the plant has <%= plant.hasLeaves ? '' : 'no ' %>leaves"
          />
          <span class="tooltip-content tooltip-top">
            <%= plant.hasLeaves ? 'Has ' : 'Has no ' %>leaves
          </span>
        </div>

        <div class="has-tooltip touchscreen-hover" data-flowers>
          <img
            src="/public/img/icons/flowers-<%= plant.hasFlowers %>.svg"
            alt="An icon showing that the plant has <%= plant.hasFlowers ? '' : 'no ' %>flowers"
          />
          <span class="tooltip-content tooltip-top">
            <%= plant.hasFlowers ? 'Has ' : 'Has no ' %>flowers
          </span>
        </div>
        <div class="has-tooltip touchscreen-hover" data-sun>
          <img
            src="/public/img/icons/sun-<%= plant.sunExposure.toLowerCase() %>.svg"
            alt="An icon showing that the plant has <%= plant.sunExposure.toLowerCase().replace('ne', '') %> sun exposure"
          />
          <span class="tooltip-content tooltip-top">
            <%= plant.sunExposure.replace('ne', '') %> sun exposure
          </span>
        </div>
        <div class="has-tooltip touchscreen-hover" data-fruit>
          <img
            src="/public/img/icons/fruits-or-nuts-<%= plant.hasFruit || plant.hasSeeds %>.svg"
            alt="An icon showing that the plant has <%= plant.hasFruit || plant.hasSeeds ? '' : 'no ' %>fruits or nuts"
          />
          <span class="tooltip-content tooltip-top">
            <%= plant.hasFruit || plant.hasSeeds ? 'Has ' : 'Has no ' %>
            fruit/nuts
          </span>
        </div>
        <div
          class="has-tooltip touchscreen-hover aspect-square h-[3rem] rounded-full"
          style="background-color: <%= plant.colour %>"
          data-colour
        >
          <span class="tooltip-content tooltip-top"> Colour of plant </span>
        </div>
      </div>
      <div class="flex flex-row justify-around gap-2 p-2">
        <button
          class="hover-button-secondary text-center21 w-1/2 rounded-lg px-4 py-2 text-sm font-bold"
          data-toggle="modal"
          data-target="<%= editModalName %>"
        >
          Suggest Edit
        </button>
      </div>
    </div>
  </div>
  <!-- chat Div -->
  <div class="fixed bottom-0 right-0 mb-10 mr-10">
    <button
      id="open-chat"
      class="hover-button material-symbols-outlined fill-0 rounded-lg bg-accent p-2.5"
    >
      forum
    </button>
  </div>
  <div
    id="chat-interface"
    class="fixed bottom-10 right-1/2 hidden w-96 max-w-[83.33333vw] translate-x-1/2 sm:right-10 sm:translate-x-0"
  >
    <div class="w-full max-w-lg rounded-lg bg-white shadow-md">
      <div
        class="flex items-center justify-between rounded-t-lg border-b bg-primary p-4"
      >
        <p class="font-semibold text-white dark:text-on-secondary">Comments</p>
        <button
          id="close-chat"
          class="close-modal flex justify-center rounded bg-background hover:bg-error hover:text-background"
          aria-label="close chat"
        >
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div id="chatbox" class="h-80 overflow-y-auto p-4">
        <!-- Chat messages will be displayed here -->
      </div>
      <div class="flex border-t p-4">
        <form id="chat-form" class="flex w-full">
          <input
            id="user-id"
            type="text"
            class="hidden"
            value="user-placeholder"
          />
          <input
            id="plant-id"
            type="text"
            class="hidden"
            value="<%= plant.id %>"
          />
          <input
            id="user-input"
            type="text"
            placeholder="Type a message"
            class="w-full rounded-l-md border px-3 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-accent"
          />
          <button
            id="send-button"
            class="hover-button material-symbols-outlined rounded-r-md bg-primary px-4 py-2 transition duration-300"
          >
            send
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<div
  class="modal invisible"
  id="<%= editModalName %>"
  tabindex="-1"
  role="dialog"
>
  <div class="modal-overlay" data-close="modal"></div>
  <div class="modal-container">
    <div class="mb-4 flex items-center justify-between">
      <h5 class="modal-title text-xl font-semibold">Edit a plant sighting</h5>
      <button
        class="close-modal flex justify-center rounded border border-gray-300 bg-background hover:bg-error hover:text-background"
        aria-label="Close modal"
        title="Close modal"
        data-close="modal"
      >
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
    <div class="modal-body">
      <form
        id="editPlantForm-<%= plant._id %>"
        target="fakesubmit"
        data-form="plant"
        data-plant="<%= plant._id %>"
        enctype="multipart/form-data"
        method="POST"
        autocomplete="off"
        class="w-[32rem] max-w-[70vw]"
      >
        <input id="_id" name="_id" type="hidden" value="<%= plant._id %>" />
        <input id="_id" name="_id" type="hidden" value="<%= plant._id %>" />
        <div class="form-group mb-4">
          <label for="name" class="block text-text">Name</label>
          <input
            type="text"
            class="form-input mt-1 block w-full rounded border border-gray-300 bg-background-light pl-2 text-text"
            id="name"
            name="name"
            maxlength="40"
            required
            value="<%= plant.name %>"
          />
        </div>
        <div class="form-group mb-4">
          <label for="description" class="block text-text">Description</label>
          <textarea
            type="textarea"
            class="form-input mt-1 block w-full resize-none rounded border border-gray-300 bg-background-light pl-2 text-text"
            id="description"
            name="description"
            rows="3"
            maxlength="256"
            required
          >
      <%= plant.description %>
    </textarea
          >
        </div>
        <% const d = plant.dateTimeSeen %>
        <!-- prettier-ignore -->
        <% const formattedDate =
                ('000' + d.getFullYear()).slice(-4) + "-" + ('0' + (d.getMonth()+1)).slice(-2) + '-' +
                ('0' + d.getDate()).slice(-2) + "T" + ('0' + d.getHours()).slice(-2) + ":" +
                ('0' + d.getMinutes()).slice(-2);
        %>
        <div class="form-group mb-4">
          <label for="dateTimeSeen" class="block text-text">Time seen</label>
          <input
            type="datetime-local"
            id="dateTimeSeen"
            name="dateTimeSeen"
            class="form-input mt-1 block w-full rounded border border-gray-300 bg-background-light pl-2 text-text"
            value="<%= formattedDate %>"
            required
          />
        </div>
        <div class="form-group mb-4">
          <label for="size" class="block text-text">Size (cm)</label>
          <input
            type="number"
            class="form-input mt-1 block w-full rounded border border-gray-300 bg-background-light pl-2 text-text"
            id="size"
            name="size"
            min="0"
            value="<%= plant.size %>"
            step=".01"
            required
          />
        </div>
        <!-- Select -->
        <div class="form-group mb-4">
          <label for="sunExposure" class="block text-text">Sun Exposure</label>
          <select
            id="sunExposure"
            name="sunExposure"
            class="form-input block w-full rounded-lg border border-gray-300 bg-background-light p-2.5 text-sm text-text focus:border-background-hover focus:ring-background"
          >
            <!-- prettier-ignore -->
            <option selected="<%= (plant.sunExposure === 'None') ? 'selected' : '' %>">
              None
            </option>
            <!-- prettier-ignore -->
            <option selected="<%= (plant.sunExposure === 'Partial') ? 'selected' : '' %>">
              Partial
            </option>
            <!-- prettier-ignore -->
            <option selected="<%= (plant.sunExposure === 'Full') ? 'selected' : '' %>">
              Full
            </option>
          </select>
        </div>

        <div class="form-group mb-4">
          <label for="colour" class="block text-text">Plant Colour</label>
          <input
            type="color"
            name="colour"
            class="form-input block h-10 w-14 cursor-pointer rounded border border-gray-300 bg-background-light p-1 text-text"
            id="hs-color-input"
            value="<%= plant.colour %>"
            title="Select plant colour"
            required
          />
        </div>

        <!-- Checkboxes -->
        <!-- In checkboxes: hasFlowers, hasLeaves & sunExposure -->
        <label for="properties" class="block text-text">Properties</label>
        <div
          id="properties"
          class="form-group mb-4 flex flex-col justify-between sm:flex-row"
        >
          <div class="mb-2 flex items-center">
            <input
              id="hasFlowers"
              name="hasFlowers"
              type="checkbox"
              value="true"
              class="form-input focus:primary-hover h-6 w-6 rounded border-text-hover bg-text text-primary"
              checked="<%= plant.hasFlowers ? 'checked' : '' %>"
            />
            <label for="hasFlowers" class="ms-2 text-sm font-medium text-text">
              Flowers
            </label>
          </div>
          <div class="mb-2 flex items-center">
            <input
              id="hasLeaves"
              name="hasLeaves"
              type="checkbox"
              value="true"
              class="form-input focus:primary-hover h-6 w-6 rounded border-text-hover bg-text text-primary"
              checked="<%= plant.hasLeaves ? 'checked' : '' %>"
            />
            <label for="hasLeaves" class="ms-2 text-sm font-medium text-text">
              Leaves
            </label>
          </div>
          <div class="mb-2 flex items-center">
            <input
              id="hasFruit"
              name="hasFruit"
              type="checkbox"
              value="true"
              class="form-input focus:primary-hover h-6 w-6 rounded border-text-hover bg-text text-primary"
              checked="<%= plant.hasFruit ? 'checked' : '' %>"
            />
            <label for="hasFruit" class="ms-2 text-sm font-medium text-text">
              Fruit
            </label>
          </div>
          <div class="mb-2 flex items-center">
            <input
              id="hasSeeds"
              name="hasSeeds"
              type="checkbox"
              value="true"
              class="form-input focus:primary-hover h-6 w-6 rounded border-text-hover bg-text text-primary"
              checked="<%= plant.hasSeeds ? 'checked' : '' %>"
            />
            <label for="hasSeeds" class="ms-2 text-sm font-medium text-text">
              Seeds
            </label>
          </div>
        </div>

        <!-- checkbox for using a file or a url for image -->
        <label for="imageSettings<%=plant._id%>" class="block text-text"
          >Image Settings</label
        >
        <div
          id="imageSettings<%=plant._id%>"
          class="form-group mb-4 flex flex-col justify-between sm:flex-row"
        >
          <div class="mb-2 flex items-center">
            <input
              id="imageInputCheckbox<%=plant._id%>"
              name="imageInput"
              type="checkbox"
              value="url"
              class="form-input focus:primary-hover h-6 w-6 rounded border-text-hover bg-text text-primary"
              data-change="toggle-input"
            />
            <label
              for="imageInputCheckbox"
              class="ms-2 text-sm font-medium text-text"
              >Use URL for image?</label
            >
          </div>
          <div class="mb-2 flex items-center">
            <input
              id="imageValidated<%=plant._id%>"
              name="imageValidated"
              type="checkbox"
              value="true"
              class="form-input focus:primary-hover h-6 w-6 rounded border-text-hover bg-text text-primary"
              required
              disabled
              checked
              oninvalid="this.setCustomValidity('Upload or enter a valid URL and preview to continue')"
            />
            <label
              for="imageValidated<%=plant._id%>"
              class="ms-2 text-sm font-medium text-text"
              >Image validated?</label
            >
          </div>
        </div>
        <div class="form-group mb-4" id="imageDiv<%=plant._id%>">
          <label class="block text-text" for="image<%=plant._id%>"
            >Upload Image</label
          >
          <input
            class="file:form-input file:hover-button w-full cursor-pointer file:rounded file:px-4 file:py-2 file:font-bold"
            id="image<%=plant._id%>"
            name="image"
            type="file"
            aria-describedby="file_input_help"
            accept="image/png, image/jpeg, image/gif"
            data-change="preview"
            data-default="<%= plant.image %>"
          />
        </div>
        <div
          class="form-group mb-4 flex hidden space-x-2"
          id="urlDiv<%=plant._id%>"
        >
          <div class="w-3/4">
            <label for="url<%=plant._id%>">Enter URL:</label>
            <input
              type="text"
              id="url<%=plant._id%>"
              name="url"
              class="form-input mt-1 block w-full grow-0 rounded border border-gray-300 bg-background-light pl-2 text-text"
            />
          </div>
          <button
            class="form-input hover-button w-1/4 grow-0 rounded px-4 py-2 font-bold"
            type="button"
            data-click="preview"
          >
            Preview
          </button>
        </div>
        <div id="imagePreviewContainer<%=plant._id%>">
          <label class="block text-text" for="preview">Image Preview</label>
          <object
            type="image/svg+xml"
            data="/public/img/loading.svg"
            class="hidden aspect-square w-1/2 rounded"
          ></object>
          <img
            id="preview<%=plant._id%>"
            src="<%= plant.image %>"
            alt="your image"
            class="w-1/2"
            data-img="preview"
          />
        </div>
        <p
          id="previewError<%=plant._id%>"
          class="my-2 hidden px-2 font-bold text-error"
        ></p>
        <div class="form-group mb-4 flex space-x-2">
          <input
            type="text"
            id="latitude<%=plant._id%>"
            name="latitude"
            class="form-input mt-1 block hidden w-full rounded border border-gray-300 bg-background-light pl-2 text-text"
            value="<%= plant.latitude %>"
            required
            readonly
          />
          <input
            type="text"
            id="longitude<%=plant._id%>"
            name="longitude"
            class="form-input mt-1 block hidden w-full rounded border border-gray-300 bg-background-light pl-2 text-text"
            value="<%= plant.longitude %>"
            readonly
          />
          <div class="w-3/4">
            <label for="coordinates">Coordinates:</label>
            <input
              type="text"
              id="coordinates<%=plant._id%>"
              name="coordinates"
              class="form-input mt-1 block w-full grow-0 rounded border border-gray-300 bg-background-light pl-2 text-text"
              value="(<%= plant.latitude %>,<%= plant.longitude %>)"
              required
              readonly
            />
          </div>
          <button
            class="form-input hover-button w-1/4 grow-0 rounded px-4 py-2 font-bold"
            type="button"
            data-click="geolocation"
          >
            Get
          </button>
        </div>
        <div class="mt-4 flex w-full space-x-4" id="buttonsDiv">
          <button
            id="submitButton"
            type="submit"
            class="form-input hover-button rounded px-4 py-2 font-bold"
          >
            Submit
          </button>
          <button
            id="deleteButton"
            type="button"
            class="form-input hover-button-error rounded px-4 py-2 font-bold"
            data-click="delete"
          >
            Delete
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
